<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distancia</title>

    <style>
        div#mapa {
            width: 700px;
            height: 700px;
        }
    </style>

    <script type="text/javascript"
        src="http://maps.google.com/maps/api/js?libraries=geometry&key=AIzaSyBY5CuaTmzLXwyn0yWS8NLMVbqWMMSydNc"></script>

    <script>

        function crearMapa() {

            var divMapa = document.querySelector("#mapa");

            var centro = new google.maps.LatLng(37.41134051634971, -5.983433420925049);

            var opciones = {
                center: centro,         // El centro que hemos establecido
                zoom: 3             // Cantidad de zoom que tendra al iniciar
            }

            // Por ultimo creamos el mapa
            var mapa = new google.maps.Map(divMapa, opciones);
        }

        function LeerFichero() {

            console.log(`e.target.files = ${e.target.files}`);
            var fichero = e.target.files[0];

            function ConvertirAXML(texto) {
                var xml = new DOMParser().parseFromString(texto, "text/xml");
                console.log("xml: ", xml);

                return xml;
            }

            var reader = new FileReader();

            reader.onload = function (e) {
                TratarFicheroXML(ConvertirAXML(reader.result))
            }

            reader.readAsText(fichero);
        }

        function TratarFicheroXML(xml) {
            var sal = document.querySelector("#sal");
            var puntos = xml.getElementsByTagName("trkpt");

            var mapa = crearMapa();

            alert("Numero de puntos: " + puntos.length);
            sal.innerHTML += "<p>Listado de puntos:</p>"

            var latitud, longitud;
            for (var i = 0; i < puntos.length; i++) {
                latitud = puntos[i].getAttributeNode("lat").nodeValue;
                longitud = puntos[i].getAttributeNode("lon").nodeValue;

                var marcador = new google.maps.Marker({
                    position: new google.maps.LatLng(latitud, longitud),
                    map: mapa,
                    title: "Ruta",
                    animation: google.maps.Animation.BOUNCE
                })

                sal.innerHTML += `latitud: ${latitud}  longitud: ${longitud} <br>`;
            }
        }

        window.onload = function () {

            document.querySelector("#id_fichero").addEventListener('change', LeerFichero, false);
        }

    </script>
</head>

<body>

    <p>
        <label for="id_fichero">Selecciona el fichero a leer</label><br>
        <input type="file" id="id_fichero">
    </p>

    <div id="mapa">

    </div>
    <div id="sal"></div>
</body>

</html>